<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tableau de bord utilisateur</title>
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="stylesheet" href="styles/common.css">
</head>
<body class="dashboard-page">
    <style>
    /* Hamburger / sidebar responsive helper for user dashboard */
    /* hamburger sits above normal content so user can always tap it */
    .header-hamburger { display:none; background:#fff; color:#333; padding:6px 10px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.12); cursor:pointer; margin-right:12px; z-index:200100; border:0 }
    /* ensure header does not overlap the sidebar when open */
    header { position:relative; z-index:50 }

    /* Base sidebar styles - fixed, full height, off-canvas via transform */
    /* Use the same dark gradient background as the manager dashboard for visual consistency */
    .sidebar { width:280px; max-width:85vw; height:100vh; background: linear-gradient(135deg,#2c3e50 0%,#34495e 100%); color: #fff; position:fixed; left:0; top:0; box-shadow: 2px 0 24px rgba(0,0,0,0.18); z-index:200000; will-change:transform; display:block; transform: translateX(0); }
    .sidebar a { color: rgba(255,255,255,0.95); }

    /* Overlay hidden by default - use opacity so transforms and stacking behave reliably */
    #sidebarOverlayUser { display:block; position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:199990; pointer-events:none; opacity:0; transition:opacity .2s ease; }

    /* When body has class sidebar-open, show the sidebar and overlay */
    body.sidebar-open .sidebar { transform: translateX(0) !important; pointer-events:auto }
    body.sidebar-open #sidebarOverlayUser { opacity:1; pointer-events:auto }

    /* Disable pointer events on main content when sidebar open so menu is interactive */
    body.sidebar-open .main-content, body.sidebar-open .dashboard-sections { pointer-events:none; filter:blur(0.1px); }

    @media (max-width:900px){
        /* Mobile: sidebar is off-canvas by default */
        .sidebar { transform: translateX(-112%); transition: transform .28s cubic-bezier(.2,.9,.2,1); }
        .header-hamburger { display:inline-block }
        .dashboard-container { margin-left:0 }
    }
    </style>
    <style>
    /* Small notification badges for nav links */
    .nav-badge{display:inline-flex;min-width:18px;height:18px;padding:0 6px;margin-left:6px;border-radius:999px;background:#ef4444;color:#fff;font-size:.75rem;align-items:center;justify-content:center;line-height:1;font-weight:800}
    </style>
    <header>
        <nav>
            <div class="logo">RoomReservation</div>
            <div class="nav-links">
                <a href="#" class="notification-link">Notifications <span id="notification-count">0</span></a>
                <a href="#" id="logoutLink">Déconnexion</a>
            </div>
        </nav>
    </header>

    <main class="dashboard">
        <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Mon compte</h2>
                <div class="account-info">
                    <div><strong>Nom :</strong> <span id="sidebarNom">-</span></div>
                    <div><strong>Prénom :</strong> <span id="sidebarPrenom">-</span></div>
                    <div><strong>Email :</strong> <span id="sidebarEmail">-</span></div>
                    <div><strong>Tél :</strong> <span id="sidebarTelephone">-</span></div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" class="nav-link active" data-section="overview">Tableau de bord</a></li>
                    <li><a href="#" class="nav-link" data-section="reservations">Mes réservations <span id="badge-user-reservations" class="nav-badge" style="display:none">0</span></a></li>
                    <li><a href="#" class="nav-link" data-section="notifications">Notifications <span id="badge-user-notifs" class="nav-badge" style="display:none">0</span></a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <button class="btn-logout" id="logoutBtn">Se déconnecter</button>
            </div>
    </aside>
            <div id="sidebarOverlayUser" aria-hidden="true"></div>

    <section class="main-content">
            <div class="content-header">
                    <div class="header-left">
                        <!-- Visible hamburger for mobile -->
                        <button id="hamburgerBtn" class="header-hamburger" aria-label="Ouvrir le menu" aria-expanded="false">☰</button>
                        <h1 class="site-logo">Bienvenue</h1>
                        <p>Voici l'état de vos réservations et messages</p>
                    </div>
                    <div class="header-right">
                        <!-- header right intentionally empty on dashboard; user info and logout live in sidebar only -->
                    </div>
            </div>

            <div class="dashboard-sections">
                <div id="section-overview" class="dashboard-section active">
                    <div class="stats-cards">
                        <div class="stat-card">
                            <h3>Réservations</h3>
                            <div class="stat-number" id="totalReservations">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Réservations en attente</h3>
                            <div class="stat-number" id="pendingReservations">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Réservations acceptées</h3>
                            <div class="stat-number" id="acceptedReservations">0</div>
                        </div>
                    </div>

                    <div class="recent-activities">
                        <h3>Activités récentes</h3>
                        <div class="activities-list" id="activitiesList">
                            <!-- items injected here -->
                        </div>
                    </div>
                </div>

                <div id="section-reservations" class="dashboard-section">
                    <h2>Mes réservations</h2>
                    <div class="reservations-list" id="reservationsList"></div>
                </div>

                <div id="section-notifications" class="dashboard-section">
                    <h2>Notifications</h2>
                    <div id="notificationsList"></div>
                </div>
            </div>
        </section>
        </div>
    </main>

    <script type="module" src="js/user_dashboard.js"></script>
    <script>
    // Toggle sidebar for user dashboard (mobile) — robust version
    (function(){
        function initSidebarToggle(){
            const btn = document.getElementById('hamburgerBtn');
            const overlay = document.getElementById('sidebarOverlayUser');
            const sidebar = document.querySelector('.sidebar');
            if (!btn || !overlay || !sidebar) return;

            function openSidebar(){
                document.body.classList.add('sidebar-open');
                // ensure sidebar slides in
                sidebar.style.transform = 'translateX(0)';
                // show overlay using opacity so stacking contexts render correctly
                overlay.style.opacity = '1';
                overlay.setAttribute('aria-hidden','false');
                // mark expanded state for assistive tech and disable hamburger while open
                btn.setAttribute('aria-expanded','true');
                btn.disabled = true;
                // prevent background scrolling while menu open
                document.body.style.overflow = 'hidden';
                // set focus to first link in the sidebar for accessibility
                const firstLink = sidebar.querySelector('a');
                if (firstLink) firstLink.focus();
            }

            function closeSidebar(){
                document.body.classList.remove('sidebar-open');
                // slide sidebar out on small screens
                if (window.innerWidth <= 900) sidebar.style.transform = 'translateX(-112%)';
                overlay.style.opacity = '0';
                overlay.setAttribute('aria-hidden','true');
                // restore hamburger state
                btn.setAttribute('aria-expanded','false');
                btn.disabled = false;
                // restore page scrolling
                document.body.style.overflow = '';
                // return focus to a logical place (logo)
                const logo = document.querySelector('.logo'); if (logo) logo.focus();
            }

            btn.addEventListener('click', () => {
                console.debug('[UI DASH] hamburger clicked, sidebar-open=', document.body.classList.contains('sidebar-open'));
                if (document.body.classList.contains('sidebar-open')) closeSidebar(); else openSidebar();
            });

            overlay.addEventListener('click', closeSidebar);

            document.querySelectorAll('.sidebar a').forEach(a => a.addEventListener('click', () => { closeSidebar(); }));

            // ensure correct state on resize
            window.addEventListener('resize', () => {
                if (window.innerWidth > 900) {
                    // desktop: show sidebar and ensure hamburger visible
                    sidebar.style.transform = '';
                    overlay.style.display = 'none';
                    btn.style.display = '';
                    document.body.classList.remove('sidebar-open');
                } else {
                    // mobile: hide sidebar by default
                    if (!document.body.classList.contains('sidebar-open')) sidebar.style.transform = 'translateX(-100%)';
                }
            });

            // initialize state
            if (window.innerWidth <= 900) sidebar.style.transform = 'translateX(-100%)';
        }

        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initSidebarToggle); else initSidebarToggle();
    })();
    </script>
</body>
</html>
